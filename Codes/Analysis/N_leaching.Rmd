---
title: "N leaching"
author: "Qianqian Du"
date: "2025-02-15"
output: html_document
---

# uplode the packages
```{r, message=FALSE, warning=FALSE}
library(apsimx)
library(here)
library(tidyverse)
library(ggplot2)
library(data.table)
library(oce)
library(lubridate)
library(gam)
``` 

# corn-corn consistent setting
```{r}

cc_consisten_b105 <- readRDS(here::here("Data", "Processed-Data", "Normal_till", "cc_consistent_B105.rds"))


### Annual values ###
annual_cc_coon_leaching <- cc_consisten_b105 %>% 
  .[, .(annu_leach = max(AnnualNleaching)), .(year, plot_id)]

ggplot(data = annual_cc_coon_leaching)+
  geom_point(aes(x = year, y = annu_leach, color = plot_id))+
  geom_line(aes(x = year, y = annu_leach, color = plot_id))+
      scale_color_manual(
    name = "N level",  # Change legend title
    values = c("pink", "orange", "green", "blue", "cyan", "purple", "red"), # Adjust colors if needed
    labels = c("0", "50", "100", "150", "200", "250", "300")  # Change labels
  )


### Daily values ###

ggplot(data = cc_consisten_b105[year == 2016, ])+
  geom_point(aes(x = Date, y = AnnualNleaching, color = plot_id))+
  scale_color_manual(
    name = "N level",  # Change legend title
    values = c("pink", "orange", "green", "blue", "cyan", "purple", "red"), # Adjust colors if needed
    labels = c("0", "50", "100", "150", "200", "250", "300")  # Change labels
  )


ggplot(data = cc_consisten_b105)+
  geom_point(aes(x = Date, y = AnnualNleaching, color = plot_id))+
  facet_grid(.~ year)+
    scale_color_manual(
    name = "N level",  # Change legend title
    values = c("pink", "orange", "green", "blue", "cyan", "purple", "red"), # Adjust colors if needed
    labels = c("0", "50", "100", "150", "200", "250", "300")  # Change labels
  )


```


# corn-corn ofpe setting
```{r}


# Define file paths
rds_files <- c(
  "cc_ofpe_B105_1.rds",
  "cc_ofpe_B105_2.rds",
  "cc_ofpe_B105_3.rds",
  "cc_ofpe_B105_4.rds"
)

# Initialize list to hold summaries
summary_list <- list()

# Loop through each file and process separately
for (i in seq_along(rds_files)) {
  # Read in the file
  temp_data <- readRDS(here::here("Data", "Processed-Data", "Normal_till", rds_files[i]))
  
  # Summarize max annual leaching per plot and year
  temp_summary <- temp_data[, .(annu_leach = max(AnnualNleaching)), by = .(year, plot_id)]
  
  # Store summarized data
  summary_list[[i]] <- temp_summary
  
  # Clean up
  rm(temp_data)
  gc()  # Call garbage collection to free memory
}

# Combine the summarized outputs
annual_cc_ofpe_leaching <- rbindlist(summary_list)


###--- find the distribution of N leaching in different N application levels ---###

annual_cc_ofpe_leaching$year <- as.character(annual_cc_ofpe_leaching$year)


ggplot(data = annual_cc_ofpe_leaching[year != 2014, ])+
  geom_boxplot(aes(x = year, y = annu_leach))+
  ylim(0, 80)+
  theme_bw()


```

# corn-soy consistent setting
```{r}

cs_consistent_b105 <- readRDS(here::here("Data", "Processed-Data", "Normal_till","corn_soy_consistent_B105.rds"))

### Annual values ###
annual_cs_consis_leaching <- cs_consistent_b105 %>% 
  .[, .(annu_leach = max(AnnualNleaching)), .(year, plot_id)]

ggplot(data = annual_cs_consis_leaching)+
  geom_point(aes(x = year, y = annu_leach, color = plot_id))+
  geom_line(aes(x = year, y = annu_leach, color = plot_id))+
      scale_color_manual(
    name = "N level",  # Change legend title
    values = c("pink", "orange", "green", "blue", "cyan", "purple", "red"), # Adjust colors if needed
    labels = c("0", "50", "100", "150", "200", "250", "300")  # Change labels
  )


### Daily values ###

ggplot(data = cs_consistent_b105[year == 2019, ])+
  geom_point(aes(x = Date, y = AnnualNleaching, color = plot_id))+
    scale_color_manual(
    name = "N level",  # Change legend title
    values = c("pink", "orange", "green", "blue", "cyan", "purple", "red"), # Adjust colors if needed
    labels = c("0", "50", "100", "150", "200", "250", "300")  # Change labels
  )


ggplot(data = cs_consistent_b105)+
  geom_point(aes(x = Date, y = AnnualNleaching, color = plot_id))+
  facet_grid(.~ year)+
    geom_point(aes(x = Date, y = AnnualNleaching, color = plot_id))+
    scale_color_manual(
    name = "N level",  # Change legend title
    values = c("pink", "orange", "green", "blue", "cyan", "purple", "red"), # Adjust colors if needed
    labels = c("0", "50", "100", "150", "200", "250", "300")  # Change labels
  )

```

# corn-soy ofpe setting
```{r}

# Define file paths
rds_files <- c(
  "corn_soy_ofpe_B105_1.rds",
  "corn_soy_ofpe_B105_2.rds",
  "corn_soy_ofpe_B105_3.rds",
  "corn_soy_ofpe_B105_4.rds"
)

# Initialize list to hold summaries
summary_list <- list()

# Loop through each file and process separately
for (i in seq_along(rds_files)) {
  # Read in the file
  temp_data <- readRDS(here::here("Data", "Processed-Data", "Normal_till", rds_files[i]))
  
  # Summarize max annual leaching per plot and year
  temp_summary <- temp_data[, .(annu_leach = max(AnnualNleaching)), by = .(year, plot_id)]
  
  # Store summarized data
  summary_list[[i]] <- temp_summary
  
  # Clean up
  rm(temp_data)
  gc()  # Call garbage collection to free memory
}

# Combine the summarized outputs
annual_cs_ofpe_leaching <- rbindlist(summary_list)



###--- find the distribution of N leaching in different N application levels ---###

annual_cs_ofpe_leaching$year <- as.character(annual_cs_ofpe_leaching$year)

ggplot(data = annual_cs_ofpe_leaching[year != 2014, ])+
  geom_boxplot(aes(x = year, y = annu_leach))+
  ylim(0, 80)+
  theme_bw()


```












